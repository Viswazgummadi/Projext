<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enigma</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/boxicons/2.0.7/css/boxicons.min.css"
    />
  </head>
  <body>
    <div class="header-container">
      <!-- Logo and name -->
      <div class="logo-name">
        <img
          id="logo"
          src="{{ url_for('static', filename='assets/9032132.png') }}"
          alt="logo"
        />
        <h1>Enigma</h1>
      </div>

      <!-- Icons -->
      <div class="header-icons">
        <!-- Icon with tooltip for Favorites -->
        <div class="tooltip">
          <a href="/"><i class="bx bx-home-smile"></i></a>
          <span class="tooltiptext">home</span>
        </div>

        <div class="tooltip">
          <a href="favs.html"><i class="bx bx-book-heart"></i></a>
          <span class="tooltiptext">Favorites</span>
        </div>

        <!-- Icon with tooltip for Cart -->
        <div class="tooltip">
          <a href="cart.html"><i class="bx bxs-shopping-bag"></i></a>
          <span class="tooltiptext">Cart</span>
        </div>

        <!-- Icon with tooltip for Work -->
        <div class="tooltip">
          <a href="work.html"><i class="bx bxs-network-chart"></i></a>
          <span class="tooltiptext">Work</span>
        </div>

        <!-- Icon with tooltip for Crew -->
        <div class="tooltip">
          <a href="crew.html"><i class="bx bxs-id-card"></i></a>
          <span class="tooltiptext">Crew</span>
        </div>
      </div>
    </div>
    <!-- Description of Image Segmentation Section -->
    <div class="card-container" id="encards">
      <div class="card">
        <div class="card-content">
          <h2>Card 1</h2>
          <p>
            This is the description for Card 1. Lorem ipsum dolor sit amet,
            consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut
            labore et dolore magna aliqua.
          </p>
        </div>
      </div>

      <div class="card">
        <div class="card-content">
          <h2>Card 2</h2>
          <p>
            This is the description for Card 2. Ut enim ad minim veniam, quis
            nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
            consequat.
          </p>
        </div>
      </div>

      <div class="card">
        <div class="card-content">
          <h2>Card 3</h2>
          <p>
            This is the description for Card 3. Duis aute irure dolor in
            reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
            pariatur.
          </p>
        </div>
      </div>
    </div>
    <div class="card-container">
      <div class="card">
        <div class="card-content">
          <h2>Card 1</h2>
          <p>
            This is the description for Card 1. Lorem ipsum dolor sit amet,
            consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut
            labore et dolore magna aliqua.
          </p>
        </div>
      </div>

      <div class="card">
        <div class="card-content">
          <h2>Card 2</h2>
          <p>
            This is the description for Card 2. Ut enim ad minim veniam, quis
            nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
            consequat.
          </p>
        </div>
      </div>

      <div class="card">
        <div class="card-content">
          <h2>Card 3</h2>
          <p>
            This is the description for Card 3. Duis aute irure dolor in
            reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
            pariatur.
          </p>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
          var dropArea = document.getElementById('drop-area');

          // Prevent default drag behaviors
          ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
              dropArea.addEventListener(eventName, preventDefaults, false);
              document.body.addEventListener(eventName, preventDefaults, false);
          });

          // Highlight drop area when item is dragged over it
          ['dragenter', 'dragover'].forEach(eventName => {
              dropArea.addEventListener(eventName, highlight, false);
          });

          // Remove highlight when item is dragged out of drop area
          ['dragleave', 'drop'].forEach(eventName => {
              dropArea.addEventListener(eventName, unhighlight, false);
          });

          // Handle dropped files
          dropArea.addEventListener('drop', handleDrop, false);

          function preventDefaults(event) {
              event.preventDefault();
              event.stopPropagation();
          }

          function highlight() {
              dropArea.classList.add('highlight');
          }

          function unhighlight() {
              dropArea.classList.remove('highlight');
          }

          function handleDrop(event) {
              var dt = event.dataTransfer;
              var files = dt.files;
              handleFiles(files);
          }

          function handleFiles(files) {
              // Handle uploaded files here
              var file = files[0]; // Assuming only one file is dropped
              document.getElementById('file-input').files = files; // Populate file input with dropped file
              document.getElementById('file-label').textContent = file.name; // Update label with file name
          }

          // Add event listener to file input for manual file selection
          document.getElementById('file-input').addEventListener('change', function(event) {
              var file = event.target.files[0];
              document.getElementById('file-label').textContent = file.name;
          });

          // Handle form submission
          document.getElementById('upload-form').addEventListener('submit', function(event) {
              event.preventDefault();
              var form = event.target;
              var formData = new FormData(form);
              fetch(form.action, {
                  method: 'POST',
                  body: formData
              })
              .then(response => response.json())
              .then(data => {
                  // Handle response (if needed)
                  console.log(data);
                  // Optionally, you can update the UI to display the processed image
              })
              .catch(error => console.error('Error:', error));
          });

          // JavaScript functions for image navigation
          var currentIndex = 0;
          var imageNames = [
              {% for image_name in image_names %}
                  "{{ image_name }}",
              {% endfor %}
          ];

          function changeImage(offset) {
              currentIndex += offset;
              if (currentIndex < 0) {
                  currentIndex = imageNames.length - 1;
              } else if (currentIndex >= imageNames.length) {
                  currentIndex = 0;
              }
              var imageElement = document.getElementById("image");
              imageElement.src = "{{ url_for('static', filename='images/') }}" + imageNames[currentIndex];
              imageElement.alt = imageNames[currentIndex];
          }

          document.addEventListener("keydown", function(event) {
              if (event.keyCode === 37) {  // Left arrow key
                  changeImage(-1);
              } else if (event.keyCode === 39) {  // Right arrow key
                  changeImage(1);
              }
          });

          var lastScrollTop = 0;

          window.addEventListener("scroll", function() {
              var currentScroll = window.pageYOffset || document.documentElement.scrollTop;

              if (currentScroll > lastScrollTop) {
                  // Scrolling down
                  var currentSection = document.querySelector('.fade-in');
                  if (currentSection.nextElementSibling) {
                      currentSection.classList.remove('fade-in');
                      currentSection.classList.add('fade-out');
                      currentSection.nextElementSibling.classList.add('fade-in');
                  }
              } else {
                  // Scrolling up
                  var currentSection = document.querySelector('.fade-in');
                  if (currentSection.previousElementSibling) {
                      currentSection.classList.remove('fade-in');
                      currentSection.classList.add('fade-out');
                      currentSection.previousElementSibling.classList.add('fade-in');
                  }
              }

              lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
          });
      });

      function toggleFavorite() {
          var heartIcon = document.getElementById('heartIcon');
          var imageSrc = document.getElementById('image').src;

          if (heartIcon.classList.contains('bxs-heart')) {
              // Remove from favorites (bxs-heart -> bx-heart)
              heartIcon.classList.remove('bxs-heart');
              heartIcon.classList.add('bx-heart');
              removeFromFavorites(imageSrc);
          } else {
              // Add to favorites (bx-heart -> bxs-heart)
              heartIcon.classList.remove('bx-heart');
              heartIcon.classList.add('bxs-heart');
              addToFavorites(imageSrc);
          }
      }

      function addToFavorites(imageSrc) {
          // Send an AJAX request to add the image to fav.csv
          var xhr = new XMLHttpRequest();
          xhr.open('POST', '/add-to-favorites', true);
          xhr.setRequestHeader('Content-Type', 'application/json');
          xhr.onreadystatechange = function () {
              if (xhr.readyState === 4 && xhr.status === 200) {
                  console.log('Image added to favorites.');
              }
          };
          xhr.send(JSON.stringify({ imageSrc: imageSrc }));
      }

      function removeFromFavorites(imageSrc) {
          // Send an AJAX request to remove the image from fav.csv
          var xhr = new XMLHttpRequest();
          xhr.open('POST', '/remove-from-favorites', true);
          xhr.setRequestHeader('Content-Type', 'application/json');
          xhr.onreadystatechange = function () {
              if (xhr.readyState === 4 && xhr.status === 200) {
                  console.log('Image removed from favorites.');
              }
          };
          xhr.send(JSON.stringify({ imageSrc: imageSrc }));
      }
    </script>
  </body>
</html>
